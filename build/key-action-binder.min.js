var zehfernando;!function(t){var n;!function(t){var n=function(){function t(){this.functions=[]}return t.prototype.add=function(t){return-1==this.functions.indexOf(t)?(this.functions.push(t),!0):!1},t.prototype.remove=function(t){return this.ifr=this.functions.indexOf(t),this.ifr>-1?(this.functions.splice(this.ifr,1),!0):!1},t.prototype.removeAll=function(){return this.functions.length>0?(this.functions.length=0,!0):!1},t.prototype.dispatch=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];for(var e=this.functions.concat(),i=0;i<e.length;i++)e[i].apply(void 0,t)},Object.defineProperty(t.prototype,"numItems",{get:function(){return this.functions.length},enumerable:!0,configurable:!0}),t}();t.SimpleSignal=n}(n=t.signals||(t.signals={}))}(zehfernando||(zehfernando={}));var KAB;!function(t){var n=function(){function t(t,n){this.keyCode=t,this.keyLocation=n,this.isActivated=!1}return t.prototype.matchesKeyboardKey=function(t,n){return!(this.keyCode!=t&&this.keyCode!=KeyActionBinder.KeyCodes.ANY||this.keyLocation!=n&&this.keyLocation!=KeyActionBinder.KeyLocations.ANY)},t}();t.KeyboardBinding=n}(KAB||(KAB={}));var KAB;!function(t){var n=function(){function t(t,n){this.buttonCode=t,this.gamepadLocation=n,this.isActivated=!1,this.value=0}return t.prototype.matchesGamepadButton=function(t,n){return!(this.buttonCode!=t&&this.buttonCode!=KeyActionBinder.GamepadButtons.ANY||this.gamepadLocation!=n&&this.gamepadLocation!=KeyActionBinder.GamepadLocations.ANY)},t}();t.GamepadButtonBinding=n}(KAB||(KAB={}));var KAB;!function(t){var n=function(){function n(t){this._id=t,this._lastActivatedTime=0,this._keyboardBindings=new Array,this._gamepadButtonBindings=new Array,this._activated=!1,this._consumed=!1,this._value=0}return n.prototype.addKeyboardBinding=function(n,e){void 0===n&&(n=KeyActionBinder.KeyCodes.ANY),void 0===e&&(e=KeyActionBinder.KeyLocations.ANY),this._keyboardBindings.push(new t.KeyboardBinding(n,e))},n.prototype.addGamepadButtonBinding=function(n,e){void 0===n&&(n=KeyActionBinder.GamepadButtons.ANY),void 0===e&&(e=KeyActionBinder.GamepadLocations.ANY),this._gamepadButtonBindings.push(new t.GamepadButtonBinding(n,e))},n.prototype.addGamepadBinding=function(){console.error("Action.addGamepadBinding() not implemented yet")},n.prototype.consume=function(){this._activated&&(this._consumed=!0)},n.prototype.interpretKeyDown=function(t,n){for(var e=0;e<this._keyboardBindings.length;e++)!this._keyboardBindings[e].isActivated&&this._keyboardBindings[e].matchesKeyboardKey(t,n)&&(this._keyboardBindings[e].isActivated=!0,this._activated=!0);this._value=this._activated?1:0},n.prototype.interpretKeyUp=function(t,n){for(var e=!1,i=0;i<this._keyboardBindings.length;i++)this._keyboardBindings[i].isActivated&&this._keyboardBindings[i].matchesKeyboardKey(t,n)&&(this._keyboardBindings[i].isActivated=!1),e=e||this._keyboardBindings[i].isActivated;this._activated=e,this._value=this._activated?1:0,this._activated&&(this._consumed=!1)},n.prototype.interpretGamepadButton=function(t,n,e,i){for(var o=!1,a=0,s=0;s<this._gamepadButtonBindings.length;s++)this._gamepadButtonBindings[s].matchesGamepadButton(t,n)&&(this._gamepadButtonBindings[s].isActivated=e,this._gamepadButtonBindings[s].value=i,o=o||e,i>a&&(a=i));this._activated=o,this._value=a,this._activated&&(this._consumed=!1)},Object.defineProperty(n.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activated",{get:function(){return this._activated&&!this._consumed},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),n}();t.Action=n}(KAB||(KAB={}));var KeyActionBinder=function(){function t(){this.bindCache={},this._isRunning=!1,this._maintainPlayerPositions=!1,this.actions={},this._onActionActivated=new zehfernando.signals.SimpleSignal,this._onActionDeactivated=new zehfernando.signals.SimpleSignal,this._onActionValueChanged=new zehfernando.signals.SimpleSignal,this._onDevicesChanged=new zehfernando.signals.SimpleSignal,this._onRecentDeviceChanged=new zehfernando.signals.SimpleSignal,this.start()}return t.prototype.start=function(){this._isRunning||(window.addEventListener("keydown",this.getBoundFunction(this.onKeyDown)),window.addEventListener("keyup",this.getBoundFunction(this.onKeyUp)),window.addEventListener("gamepadconnected",this.getBoundFunction(this.onGamepadAdded)),window.addEventListener("gamepaddisconnected",this.getBoundFunction(this.onGamepadRemoved)),this.refreshGamepadList(),this._isRunning=!0)},t.prototype.stop=function(){this._isRunning&&(window.removeEventListener("keydown",this.getBoundFunction(this.onKeyDown)),window.removeEventListener("keyup",this.getBoundFunction(this.onKeyUp)),window.removeEventListener("gamepadconnected",this.getBoundFunction(this.onGamepadAdded)),window.removeEventListener("gamepaddisconnected",this.getBoundFunction(this.onGamepadRemoved)),this._isRunning=!1)},t.prototype.action=function(t){return this.actions.hasOwnProperty(t)||(this.actions[t]=new KAB.Action(t)),this.actions[t]},t.prototype.update=function(){var t,n,e,i,o=navigator.getGamepads();for(n=0;n<o.length;n++)if(t=o[n],null!=t)for(var a in this.actions)for(i=this.actions[a],e=0;e<t.buttons.length;e++)i.interpretGamepadButton(e,n,t.buttons[e].pressed,t.buttons[e].value)},Object.defineProperty(t.prototype,"onActionActivated",{get:function(){return this._onActionActivated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onActionDeactivated",{get:function(){return this._onActionDeactivated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onActionValueChanged",{get:function(){return this._onActionValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDevicesChanged",{get:function(){return this._onDevicesChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onRecentDeviceChanged",{get:function(){return this._onRecentDeviceChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),t.prototype.onKeyDown=function(t){for(var n in this.actions)this.actions[n].interpretKeyDown(t.keyCode,t.location)},t.prototype.onKeyUp=function(t){for(var n in this.actions)this.actions[n].interpretKeyUp(t.keyCode,t.location)},t.prototype.onGamepadAdded=function(t){this.refreshGamepadList()},t.prototype.onGamepadRemoved=function(t){this.refreshGamepadList()},t.prototype.refreshGamepadList=function(){console.log("List of gamepads refreshed, new list = "+navigator.getGamepads().length+" items"),this._onDevicesChanged.dispatch()},t.prototype.getBoundFunction=function(t){return this.bindCache.hasOwnProperty(t)||(this.bindCache[t]=t.bind(this)),this.bindCache[t]},t.VERSION="0.0.0",t.KeyCodes={ANY:81653812,A:65,ALT:18,B:66,BACKQUOTE:192,BACKSLASH:220,BACKSPACE:8,C:67,CAPS_LOCK:20,COMMA:188,CTRL:17,D:68,DELETE:46,DOWN:40,E:69,END:35,ENTER:13,EQUAL:187,ESCAPE:27,F:70,F1:112,F10:121,F11:122,F12:123,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,G:71,H:72,HOME:36,I:73,INSERT:45,J:74,K:75,L:76,LEFT:37,LEFTBRACKET:219,M:77,MINUS:189,N:78,NUMBER_0:48,NUMBER_1:49,NUMBER_2:50,NUMBER_3:51,NUMBER_4:52,NUMBER_5:53,NUMBER_6:54,NUMBER_7:55,NUMBER_8:56,NUMBER_9:57,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,NUM_LOCK:144,O:79,P:80,PAGE_DOWN:34,PAGE_UP:33,PAUSE:19,PERIOD:190,Q:81,QUOTE:222,R:82,RIGHT:39,RIGHTBRACKET:221,S:83,SCROLL_LOCK:145,SELECT:93,SEMICOLON:186,SHIFT:16,SLASH:191,SPACE:32,T:84,TAB:9,U:85,UP:38,V:86,W:87,WINDOW_LEFT:91,WINDOW_RIGHT:92,X:88,Y:89,Z:90},t.KeyLocations={ANY:81653813,STANDARD:0,LEFT:1,RIGHT:2,NUMPAD:3},t.GamepadLocations={ANY:81653814},t.GamepadButtons={ANY:81653815,FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_SHOULDER_BOTTOM:6,RIGHT_SHOULDER_BOTTOM:7,SELECT:8,START:9,LEFT_ANALOGUE_STICK:10,RIGHT_ANALOGUE_STICK:11,PAD_TOP:12,PAD_BOTTOM:13,PAD_LEFT:14,PAD_RIGHT:15},t.GamepadAxes={LEFT_ANALOGUE_HOR:0,LEFT_ANALOGUE_VERT:1,RIGHT_ANALOGUE_HOR:2,RIGHT_ANALOGUE_VERT:3},t}();