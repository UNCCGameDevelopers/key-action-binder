var zehfernando;!function(e){var n;!function(e){var n=function(){function e(){this.functions=[]}return e.prototype.add=function(e){return-1==this.functions.indexOf(e)?(this.functions.push(e),!0):!1},e.prototype.remove=function(e){return this.ifr=this.functions.indexOf(e),this.ifr>-1?(this.functions.splice(this.ifr,1),!0):!1},e.prototype.removeAll=function(){return this.functions.length>0?(this.functions.length=0,!0):!1},e.prototype.dispatch=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];for(var t=this.functions.concat(),i=0;i<t.length;i++)t[i].apply(void 0,e)},Object.defineProperty(e.prototype,"numItems",{get:function(){return this.functions.length},enumerable:!0,configurable:!0}),e}();e.SimpleSignal=n}(n=e.signals||(e.signals={}))}(zehfernando||(zehfernando={}));var KAB;!function(e){var n=function(){function e(e,n){this.keyCode=e,this.keyLocation=n,this.isActivated=!1}return e.prototype.matchesKeyboardKey=function(e,n){return!(this.keyCode!=e&&this.keyCode!=KeyActionBinder.KEY_CODE_ANY||this.keyLocation!=n&&this.keyLocation!=KeyActionBinder.KEY_LOCATION_ANY)},e}();e.KeyboardBinding=n}(KAB||(KAB={}));var KAB;!function(e){var n=function(){function e(e,n){this.controlId=e,this.gamepadIndex=n}return e.prototype.matchesKeyboardKey=function(e,n){return!1},e.prototype.matchesGamepadControl=function(e,n){return this.controlId==e&&(this.gamepadIndex==n||this.gamepadIndex==KeyActionBinder.GAMEPAD_INDEX_ANY)},e}();e.GamepadBinding=n}(KAB||(KAB={}));var KAB;!function(e){var n=function(){function n(e){this._id=e,this._lastActivatedTime=0,this._keyboardBindings=new Array,this._gamepadBindings=new Array,this._activated=!1,this._consumed=!1,this._value=0}return n.prototype.addKeyboardBinding=function(n,t){void 0===n&&(n=KeyActionBinder.KEY_CODE_ANY),void 0===t&&(t=KeyActionBinder.KEY_LOCATION_ANY),this._keyboardBindings.push(new e.KeyboardBinding(n,t))},n.prototype.addGamepadBinding=function(){console.error("Action.addGamepadBinding() not implemented yet")},n.prototype.consume=function(){this._activated&&(this._consumed=!0)},n.prototype.interpretKeyDown=function(e,n){for(var t=0;t<this._keyboardBindings.length;t++)!this._keyboardBindings[t].isActivated&&this._keyboardBindings[t].matchesKeyboardKey(e,n)&&(this._keyboardBindings[t].isActivated=!0,this._activated=!0);this._value=this._activated?1:0},n.prototype.interpretKeyUp=function(e,n){for(var t=!1,i=0;i<this._keyboardBindings.length;i++)this._keyboardBindings[i].isActivated&&this._keyboardBindings[i].matchesKeyboardKey(e,n)&&(this._keyboardBindings[i].isActivated=!1),t=t||this._keyboardBindings[i].isActivated;this._activated=t,this._value=this._activated?1:0,this._activated&&(this._consumed=!1)},Object.defineProperty(n.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activated",{get:function(){return this._activated&&!this._consumed},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),n}();e.Action=n}(KAB||(KAB={}));var KeyActionBinder=function(){function e(){this.bindCache={},this._isRunning=!1,this._maintainPlayerPositions=!1,this.actions={},this._onActionActivated=new zehfernando.signals.SimpleSignal,this._onActionDeactivated=new zehfernando.signals.SimpleSignal,this._onActionValueChanged=new zehfernando.signals.SimpleSignal,this._onDevicesChanged=new zehfernando.signals.SimpleSignal,this._onRecentDeviceChanged=new zehfernando.signals.SimpleSignal,this.gameInputDevices=[],this.gameInputDeviceIds=[],this.start()}return e.prototype.start=function(){this._isRunning||(window.addEventListener("keydown",this.getBoundFunction(this.onKeyDown)),window.addEventListener("keyup",this.getBoundFunction(this.onKeyUp)),window.addEventListener("gamepadconnected",this.getBoundFunction(this.onGameInputDeviceAdded)),window.addEventListener("gamepaddisconnected",this.getBoundFunction(this.onGameInputDeviceRemoved)),this.refreshGameInputDeviceList(),this._isRunning=!0)},e.prototype.stop=function(){this._isRunning&&(window.removeEventListener("keydown",this.getBoundFunction(this.onKeyDown)),window.removeEventListener("keyup",this.getBoundFunction(this.onKeyUp)),window.removeEventListener("gamepadconnected",this.getBoundFunction(this.onGameInputDeviceAdded)),window.removeEventListener("gamepaddisconnected",this.getBoundFunction(this.onGameInputDeviceRemoved)),this._isRunning=!1)},e.prototype.action=function(e){return this.actions.hasOwnProperty(e)||(this.actions[e]=new KAB.Action(e)),this.actions[e]},e.prototype.update=function(){},Object.defineProperty(e.prototype,"onActionActivated",{get:function(){return this._onActionActivated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onActionDeactivated",{get:function(){return this._onActionDeactivated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onActionValueChanged",{get:function(){return this._onActionValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDevicesChanged",{get:function(){return this._onDevicesChanged},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onRecentDeviceChanged",{get:function(){return this._onRecentDeviceChanged},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),e.prototype.onKeyDown=function(e){for(var n in this.actions)this.actions[n].interpretKeyDown(e.keyCode,e.location)},e.prototype.onKeyUp=function(e){for(var n in this.actions)this.actions[n].interpretKeyUp(e.keyCode,e.location)},e.prototype.onGameInputDeviceAdded=function(e){console.error("NOT IMPLEMENTED: onGameInputDeviceAdded")},e.prototype.onGameInputDeviceRemoved=function(e){console.error("NOT IMPLEMENTED: onGameInputDeviceRemoved")},e.prototype.refreshGameInputDeviceList=function(){var e=navigator.getGamepads();this.gameInputDevices.length=e.length,this.gameInputDeviceIds.length=e.length;for(var n=0;n<e.length;n++)null!=this.gameInputDevices[n]?(this.gameInputDevices[n]=e[n],this.gameInputDeviceIds[n]=e[n].id):this.gameInputDeviceIds[n]=null;this._onDevicesChanged.dispatch()},e.prototype.getBoundFunction=function(e){return this.bindCache.hasOwnProperty(e)||(this.bindCache[e]=e.bind(this)),this.bindCache[e]},e.VERSION="0.0.0",e.GAMEPAD_INDEX_ANY=81653811,e.KEY_CODE_ANY=81653812,e.KEY_LOCATION_ANY=81653813,e}();