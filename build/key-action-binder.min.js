var zehfernando;!function(t){var e;!function(t){var e=function(){function t(){this.functions=[]}return t.prototype.add=function(t){return-1==this.functions.indexOf(t)?(this.functions.push(t),!0):!1},t.prototype.remove=function(t){return this.ifr=this.functions.indexOf(t),this.ifr>-1?(this.functions.splice(this.ifr,1),!0):!1},t.prototype.removeAll=function(){return this.functions.length>0?(this.functions.length=0,!0):!1},t.prototype.dispatch=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var n=this.functions.concat(),i=0;i<n.length;i++)n[i].apply(void 0,t)},Object.defineProperty(t.prototype,"numItems",{get:function(){return this.functions.length},enumerable:!0,configurable:!0}),t}();t.SimpleSignal=e}(e=t.signals||(t.signals={}))}(zehfernando||(zehfernando={}));var KAB;!function(t){var e=function(){function t(t,e){this.keyCode=t,this.keyLocation=e,this.isActivated=!1}return t.prototype.matchesKeyboardKey=function(t,e){return!(this.keyCode!=t&&this.keyCode!=KeyActionBinder.KeyCodes.ANY||this.keyLocation!=e&&this.keyLocation!=KeyActionBinder.KeyLocations.ANY)},t}();t.KeyboardBinding=e}(KAB||(KAB={}));var KAB;!function(t){var e=function(){function t(t,e){this.buttonCode=t,this.gamepadLocation=e,this.isActivated=!1,this.value=0}return t.prototype.matchesGamepadButton=function(t,e){return!(this.buttonCode!=t&&this.buttonCode!=KeyActionBinder.GamepadButtons.ANY||this.gamepadLocation!=e&&this.gamepadLocation!=KeyActionBinder.GamepadLocations.ANY)},t}();t.GamepadButtonBinding=e}(KAB||(KAB={}));var KAB;!function(t){var e=function(){function e(t){this._id=t,this._lastActivatedTime=0,this.keyboardBindings=[],this.keyboardActivated=!1,this.keyboardValue=0,this.gamepadButtonBindings=[],this.gamepadButtonActivated=!1,this.gamepadButtonValue=0,this.consumed=!1}return e.prototype.addKeyboardBinding=function(e,n){void 0===e&&(e=KeyActionBinder.KeyCodes.ANY),void 0===n&&(n=KeyActionBinder.KeyLocations.ANY),this.keyboardBindings.push(new t.KeyboardBinding(e,n))},e.prototype.addGamepadButtonBinding=function(e,n){void 0===e&&(e=KeyActionBinder.GamepadButtons.ANY),void 0===n&&(n=KeyActionBinder.GamepadLocations.ANY),this.gamepadButtonBindings.push(new t.GamepadButtonBinding(e,n))},e.prototype.addGamepadBinding=function(){console.error("Action.addGamepadBinding() not implemented yet")},e.prototype.consume=function(){this.activated&&(this.consumed=!0)},e.prototype.interpretKeyDown=function(t,e){for(var n=0;n<this.keyboardBindings.length;n++)!this.keyboardBindings[n].isActivated&&this.keyboardBindings[n].matchesKeyboardKey(t,e)&&(this.keyboardBindings[n].isActivated=!0,this.keyboardActivated=!0,this.keyboardValue=1)},e.prototype.interpretKeyUp=function(t,e){for(var n,i=!1,o=0;o<this.keyboardBindings.length;o++)this.keyboardBindings[o].matchesKeyboardKey(t,e)&&(this.keyboardBindings[o].isActivated&&(this.keyboardBindings[o].isActivated=!1),n=!0,i=i||this.keyboardBindings[o].isActivated);n&&(this.keyboardActivated=i,this.keyboardValue=this.keyboardActivated?1:0,this.keyboardActivated&&(this.consumed=!1))},e.prototype.interpretGamepadButton=function(t,e,n,i){for(var o,a=!1,s=0,d=0;d<this.gamepadButtonBindings.length;d++)this.gamepadButtonBindings[d].matchesGamepadButton(t,e)&&(o=!0,this.gamepadButtonBindings[d].isActivated=n,this.gamepadButtonBindings[d].value=i,a=a||n,i>s&&(s=i));o&&(this.gamepadButtonActivated=a,this.gamepadButtonValue=s,this.gamepadButtonActivated&&(this.consumed=!1))},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activated",{get:function(){return(this.keyboardActivated||this.gamepadButtonActivated)&&!this.consumed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return Math.max(this.keyboardValue,this.gamepadButtonValue)},enumerable:!0,configurable:!0}),e}();t.Action=e}(KAB||(KAB={}));var KeyActionBinder=function(){function t(){this.bindCache={},this._isRunning=!1,this._maintainPlayerPositions=!1,this.actions={},this._onActionActivated=new zehfernando.signals.SimpleSignal,this._onActionDeactivated=new zehfernando.signals.SimpleSignal,this._onActionValueChanged=new zehfernando.signals.SimpleSignal,this._onDevicesChanged=new zehfernando.signals.SimpleSignal,this._onRecentDeviceChanged=new zehfernando.signals.SimpleSignal,this.start()}return t.prototype.start=function(){this._isRunning||(window.addEventListener("keydown",this.getBoundFunction(this.onKeyDown)),window.addEventListener("keyup",this.getBoundFunction(this.onKeyUp)),window.addEventListener("gamepadconnected",this.getBoundFunction(this.onGamepadAdded)),window.addEventListener("gamepaddisconnected",this.getBoundFunction(this.onGamepadRemoved)),this.refreshGamepadList(),this._isRunning=!0)},t.prototype.stop=function(){this._isRunning&&(window.removeEventListener("keydown",this.getBoundFunction(this.onKeyDown)),window.removeEventListener("keyup",this.getBoundFunction(this.onKeyUp)),window.removeEventListener("gamepadconnected",this.getBoundFunction(this.onGamepadAdded)),window.removeEventListener("gamepaddisconnected",this.getBoundFunction(this.onGamepadRemoved)),this._isRunning=!1)},t.prototype.action=function(t){return this.actions.hasOwnProperty(t)||(this.actions[t]=new KAB.Action(t)),this.actions[t]},t.prototype.update=function(){var t,e,n,i,o=navigator.getGamepads();for(e=0;e<o.length;e++)if(t=o[e],null!=t)for(var a in this.actions)for(i=this.actions[a],n=0;n<t.buttons.length;n++)i.interpretGamepadButton(n,e,t.buttons[n].pressed,t.buttons[n].value)},Object.defineProperty(t.prototype,"onActionActivated",{get:function(){return this._onActionActivated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onActionDeactivated",{get:function(){return this._onActionDeactivated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onActionValueChanged",{get:function(){return this._onActionValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDevicesChanged",{get:function(){return this._onDevicesChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onRecentDeviceChanged",{get:function(){return this._onRecentDeviceChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),t.prototype.onKeyDown=function(t){for(var e in this.actions)this.actions[e].interpretKeyDown(t.keyCode,t.location)},t.prototype.onKeyUp=function(t){for(var e in this.actions)this.actions[e].interpretKeyUp(t.keyCode,t.location)},t.prototype.onGamepadAdded=function(t){this.refreshGamepadList()},t.prototype.onGamepadRemoved=function(t){this.refreshGamepadList()},t.prototype.refreshGamepadList=function(){console.log("List of gamepads refreshed, new list = "+navigator.getGamepads().length+" items"),this._onDevicesChanged.dispatch()},t.prototype.getBoundFunction=function(t){return this.bindCache.hasOwnProperty(t)||(this.bindCache[t]=t.bind(this)),this.bindCache[t]},t.VERSION="0.0.0",t.KeyCodes={ANY:81653812,A:65,ALT:18,B:66,BACKQUOTE:192,BACKSLASH:220,BACKSPACE:8,C:67,CAPS_LOCK:20,COMMA:188,CTRL:17,D:68,DELETE:46,DOWN:40,E:69,END:35,ENTER:13,EQUAL:187,ESCAPE:27,F:70,F1:112,F10:121,F11:122,F12:123,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,G:71,H:72,HOME:36,I:73,INSERT:45,J:74,K:75,L:76,LEFT:37,LEFTBRACKET:219,M:77,MINUS:189,N:78,NUMBER_0:48,NUMBER_1:49,NUMBER_2:50,NUMBER_3:51,NUMBER_4:52,NUMBER_5:53,NUMBER_6:54,NUMBER_7:55,NUMBER_8:56,NUMBER_9:57,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,NUM_LOCK:144,O:79,P:80,PAGE_DOWN:34,PAGE_UP:33,PAUSE:19,PERIOD:190,Q:81,QUOTE:222,R:82,RIGHT:39,RIGHTBRACKET:221,S:83,SCROLL_LOCK:145,SELECT:93,SEMICOLON:186,SHIFT:16,SLASH:191,SPACE:32,T:84,TAB:9,U:85,UP:38,V:86,W:87,WINDOW_LEFT:91,WINDOW_RIGHT:92,X:88,Y:89,Z:90},t.KeyLocations={ANY:81653813,STANDARD:0,LEFT:1,RIGHT:2,NUMPAD:3},t.GamepadLocations={ANY:81653814},t.GamepadButtons={ANY:81653815,FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_SHOULDER_BOTTOM:6,RIGHT_SHOULDER_BOTTOM:7,SELECT:8,START:9,LEFT_ANALOGUE_STICK:10,RIGHT_ANALOGUE_STICK:11,PAD_TOP:12,PAD_BOTTOM:13,PAD_LEFT:14,PAD_RIGHT:15},t.GamepadAxes={LEFT_ANALOGUE_HOR:0,LEFT_ANALOGUE_VERT:1,RIGHT_ANALOGUE_HOR:2,RIGHT_ANALOGUE_VERT:3},t}();