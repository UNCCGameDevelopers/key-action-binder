var zehfernando;!function(t){var e;!function(t){var e=function(){function t(){this.functions=[]}return t.prototype.add=function(t){return-1==this.functions.indexOf(t)?(this.functions.push(t),!0):!1},t.prototype.remove=function(t){return this.ifr=this.functions.indexOf(t),this.ifr>-1?(this.functions.splice(this.ifr,1),!0):!1},t.prototype.removeAll=function(){return this.functions.length>0?(this.functions.length=0,!0):!1},t.prototype.dispatch=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var i=this.functions.concat(),n=0;n<i.length;n++)i[n].apply(void 0,t)},Object.defineProperty(t.prototype,"numItems",{get:function(){return this.functions.length},enumerable:!0,configurable:!0}),t}();t.SimpleSignal=e}(e=t.signals||(t.signals={}))}(zehfernando||(zehfernando={}));var KAB;!function(t){var e=function(){function t(t,e){this.keyCode=t,this.keyLocation=e,this.isActivated=!1}return t.prototype.matchesKeyboardKey=function(t,e){return!(this.keyCode!=t&&this.keyCode!=KeyActionBinder.KeyCodes.ANY||this.keyLocation!=e&&this.keyLocation!=KeyActionBinder.KeyLocations.ANY)},t}();t.KeyboardActionBinding=e}(KAB||(KAB={}));var KAB;!function(t){var e=function(){function t(t,e){this.buttonCode=t,this.gamepadLocation=e,this.isActivated=!1,this.value=0}return t.prototype.matchesGamepadButton=function(t,e){return!(this.buttonCode!=t&&this.buttonCode!=KeyActionBinder.GamepadButtons.ANY||this.gamepadLocation!=e&&this.gamepadLocation!=KeyActionBinder.GamepadLocations.ANY)},t}();t.GamepadActionBinding=e}(KAB||(KAB={}));var KAB;!function(t){var e=function(){function e(t){this._id=t,this.timeLastActivation=0,this.toleranceTime=0,this.keyboardBindings=[],this.keyboardActivated=!1,this.keyboardValue=0,this.keyboardConsumed=!1,this.gamepadButtonBindings=[],this.gamepadButtonActivated=!1,this.gamepadButtonValue=0,this.gamepadButtonConsumed=!1}return e.prototype.bindKeyboard=function(e,i){return void 0===e&&(e=KeyActionBinder.KeyCodes.ANY),void 0===i&&(i=KeyActionBinder.KeyLocations.ANY),this.keyboardBindings.push(new t.KeyboardActionBinding(e,i)),this},e.prototype.bindGamepad=function(e,i){return void 0===e&&(e=KeyActionBinder.GamepadButtons.ANY),void 0===i&&(i=KeyActionBinder.GamepadLocations.ANY),this.gamepadButtonBindings.push(new t.GamepadActionBinding(e,i)),this},e.prototype.setTolerance=function(t){return this.toleranceTime=1e3*t,this},e.prototype.consume=function(){this.keyboardActivated&&(this.keyboardConsumed=!0),this.gamepadButtonActivated&&(this.gamepadButtonConsumed=!0)},e.prototype.interpretKeyDown=function(t,e){for(var i=0;i<this.keyboardBindings.length;i++)!this.keyboardBindings[i].isActivated&&this.keyboardBindings[i].matchesKeyboardKey(t,e)&&(this.keyboardBindings[i].isActivated=!0,this.keyboardActivated=!0,this.keyboardValue=1,this.timeLastActivation=Date.now())},e.prototype.interpretKeyUp=function(t,e){for(var i,n=!1,o=0;o<this.keyboardBindings.length;o++)this.keyboardBindings[o].matchesKeyboardKey(t,e)&&(this.keyboardBindings[o].isActivated&&(this.keyboardBindings[o].isActivated=!1),i=!0,n=n||this.keyboardBindings[o].isActivated);i&&(this.keyboardActivated=n,this.keyboardValue=this.keyboardActivated?1:0,this.keyboardActivated||(this.keyboardConsumed=!1))},e.prototype.interpretGamepadButton=function(t,e,i,n){for(var o,a=!1,s=0,r=0;r<this.gamepadButtonBindings.length;r++)this.gamepadButtonBindings[r].matchesGamepadButton(t,e)&&(o=!0,this.gamepadButtonBindings[r].isActivated=i,this.gamepadButtonBindings[r].value=n,a=a||i,n>s&&(s=n));o&&(a&&!this.gamepadButtonActivated&&(this.timeLastActivation=Date.now()),this.gamepadButtonActivated=a,this.gamepadButtonValue=s,this.gamepadButtonActivated||(this.gamepadButtonConsumed=!1))},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activated",{get:function(){return(this.keyboardActivated&&!this.keyboardConsumed||this.gamepadButtonActivated&&!this.gamepadButtonConsumed)&&this.isWithinToleranceTime()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.isWithinToleranceTime()?Math.max(this.keyboardConsumed?0:this.keyboardValue,this.gamepadButtonConsumed?0:this.gamepadButtonValue):0},enumerable:!0,configurable:!0}),e.prototype.isWithinToleranceTime=function(){return this.toleranceTime<=0||this.timeLastActivation>=Date.now()-this.toleranceTime},e}();t.Action=e}(KAB||(KAB={}));var KAB;!function(t){var e=function(){function t(){}return t.map=function(e,i,n,o,a,s){if(void 0===o&&(o=0),void 0===a&&(a=1),void 0===s&&(s=!1),i==n)return o;var r=(e-i)/(n-i)*(a-o)+o;return s&&(r=a>o?this.clamp(r,o,a):t.clamp(r,a,o)),r},t.clamp=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),e>t?e:t>i?i:t},t}();t.Utils=e}(KAB||(KAB={}));var KAB;!function(t){var e=function(){function e(t,e,i,n,o){this.keyCodeA=t,this.keyLocationA=i,this.keyCodeB=e,this.keyLocationB=n,this.transitionTime=1e3*o,this.timeLastChange=0/0,this.targetValue=this.previousValue=0}return e.prototype.matchesKeyboardKeyStart=function(t,e){return!(this.keyCodeA!=t&&this.keyCodeA!=KeyActionBinder.KeyCodes.ANY||this.keyLocationA!=e&&this.keyLocationA!=KeyActionBinder.KeyLocations.ANY)},e.prototype.matchesKeyboardKeyEnd=function(t,e){return!(this.keyCodeB!=t&&this.keyCodeB!=KeyActionBinder.KeyCodes.ANY||this.keyLocationB!=e&&this.keyLocationB!=KeyActionBinder.KeyLocations.ANY)},Object.defineProperty(e.prototype,"value",{get:function(){return isNaN(this.timeLastChange)?this.targetValue:t.Utils.map(Date.now(),this.timeLastChange,this.timeLastChange+this.currentTransitionTime,this.previousValue,this.targetValue,!0)},set:function(e){e!=this.targetValue&&(this.previousValue=this.value,this.targetValue=e,this.currentTransitionTime=t.Utils.map(Math.abs(this.targetValue-this.previousValue),0,1,0,this.transitionTime),this.timeLastChange=Date.now())},enumerable:!0,configurable:!0}),e}();t.KeyboardAxisBinding=e}(KAB||(KAB={}));var KAB;!function(t){var e=function(){function e(t,e,i){this.axisCode=t,this.deadZone=e,this.gamepadLocation=i,this._value=0}return e.prototype.matchesGamepadAxis=function(t,e){return this.axisCode==t&&(this.gamepadLocation==e||this.gamepadLocation==KeyActionBinder.GamepadLocations.ANY)},Object.defineProperty(e.prototype,"value",{get:function(){return this._value<0?t.Utils.map(this._value,-this.deadZone,-1,0,-1,!0):t.Utils.map(this._value,this.deadZone,1,0,1,!0)},set:function(t){this._value=t},enumerable:!0,configurable:!0}),e}();t.GamepadAxisBinding=e}(KAB||(KAB={}));var KAB;!function(t){var e=function(){function e(t){this._id=t,this.keyboardBindings=[],this.gamepadAxisBindings=[],this.gamepadAxisValue=0}return e.prototype.bindKeyboard=function(e,i,n,o,a){return void 0===n&&(n=KeyActionBinder.KeyLocations.ANY),void 0===o&&(o=KeyActionBinder.KeyLocations.ANY),void 0===a&&(a=.15),this.keyboardBindings.push(new t.KeyboardAxisBinding(e,i,n,o,a)),this},e.prototype.bindGamepad=function(e,i,n){return void 0===i&&(i=.2),void 0===n&&(n=KeyActionBinder.GamepadLocations.ANY),this.gamepadAxisBindings.push(new t.GamepadAxisBinding(e,i,n)),this},e.prototype.interpretKeyDown=function(t,e){for(var i=0;i<this.keyboardBindings.length;i++)this.keyboardBindings[i].matchesKeyboardKeyStart(t,e)?this.keyboardBindings[i].value=-1:this.keyboardBindings[i].matchesKeyboardKeyEnd(t,e)&&(this.keyboardBindings[i].value=1)},e.prototype.interpretKeyUp=function(t,e){for(var i=0;i<this.keyboardBindings.length;i++)this.keyboardBindings[i].matchesKeyboardKeyStart(t,e)?this.keyboardBindings[i].value=0:this.keyboardBindings[i].matchesKeyboardKeyEnd(t,e)&&(this.keyboardBindings[i].value=0)},e.prototype.interpretGamepadAxis=function(t,e,i){for(var n=0;n<this.gamepadAxisBindings.length;n++)this.gamepadAxisBindings[n].matchesGamepadAxis(t,e)&&(this.gamepadAxisBindings[n].value=i)},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){for(var t,e=0,i=0;i<this.keyboardBindings.length;i++)t=this.keyboardBindings[i].value,Math.abs(t)>Math.abs(e)&&(e=t);for(var i=0;i<this.gamepadAxisBindings.length;i++)t=this.gamepadAxisBindings[i].value,Math.abs(t)>Math.abs(e)&&(e=t);return e},enumerable:!0,configurable:!0}),e}();t.Axis=e}(KAB||(KAB={}));var KeyActionBinder=function(){function t(){this.bindCache={},this._isRunning=!1,this._maintainPlayerPositions=!1,this.actions={},this.axes={},this._onActionActivated=new zehfernando.signals.SimpleSignal,this._onActionDeactivated=new zehfernando.signals.SimpleSignal,this._onActionValueChanged=new zehfernando.signals.SimpleSignal,this._onDevicesChanged=new zehfernando.signals.SimpleSignal,this._onRecentDeviceChanged=new zehfernando.signals.SimpleSignal,this.currentFrame=0,this.lastFrameGamepadsChecked=0,this.start()}return t.prototype.start=function(){this._isRunning||(window.addEventListener("keydown",this.getBoundFunction(this.onKeyDown)),window.addEventListener("keyup",this.getBoundFunction(this.onKeyUp)),window.addEventListener("gamepadconnected",this.getBoundFunction(this.onGamepadAdded)),window.addEventListener("gamepaddisconnected",this.getBoundFunction(this.onGamepadRemoved)),this.refreshGamepadList(),this._isRunning=!0,this.incrementFrameCount())},t.prototype.stop=function(){this._isRunning&&(window.removeEventListener("keydown",this.getBoundFunction(this.onKeyDown)),window.removeEventListener("keyup",this.getBoundFunction(this.onKeyUp)),window.removeEventListener("gamepadconnected",this.getBoundFunction(this.onGamepadAdded)),window.removeEventListener("gamepaddisconnected",this.getBoundFunction(this.onGamepadRemoved)),this._isRunning=!1)},t.prototype.action=function(t){return this.lastFrameGamepadsChecked<this.currentFrame&&this.updateGamepadsState(),this.actions.hasOwnProperty(t)||(this.actions[t]=new KAB.Action(t)),this.actions[t]},t.prototype.axis=function(t){return this.lastFrameGamepadsChecked<this.currentFrame&&this.updateGamepadsState(),this.axes.hasOwnProperty(t)||(this.axes[t]=new KAB.Axis(t)),this.axes[t]},Object.defineProperty(t.prototype,"onActionActivated",{get:function(){return this._onActionActivated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onActionDeactivated",{get:function(){return this._onActionDeactivated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onActionValueChanged",{get:function(){return this._onActionValueChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDevicesChanged",{get:function(){return this._onDevicesChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onRecentDeviceChanged",{get:function(){return this._onRecentDeviceChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),t.prototype.onKeyDown=function(t){for(var e in this.actions)this.actions[e].interpretKeyDown(t.keyCode,t.location);for(var e in this.axes)this.axes[e].interpretKeyDown(t.keyCode,t.location)},t.prototype.onKeyUp=function(t){for(var e in this.actions)this.actions[e].interpretKeyUp(t.keyCode,t.location);for(var e in this.axes)this.axes[e].interpretKeyUp(t.keyCode,t.location)},t.prototype.onGamepadAdded=function(t){this.refreshGamepadList()},t.prototype.onGamepadRemoved=function(t){this.refreshGamepadList()},t.prototype.incrementFrameCount=function(){this._isRunning&&(this.currentFrame++,window.requestAnimationFrame(this.incrementFrameCount.bind(this)))},t.prototype.updateGamepadsState=function(){var t,e,i,n,o,a,s,r,d=navigator.getGamepads();for(e=0;e<d.length;e++)if(t=d[e],null!=t){for(var h in this.actions)for(o=this.actions[h],a=t.buttons,n=a.length,i=0;n>i;i++)o.interpretGamepadButton(i,e,a[i].pressed,a[i].value);for(var h in this.axes)for(s=this.axes[h],r=t.axes,n=r.length,i=0;n>i;i++)s.interpretGamepadAxis(i,e,r[i])}this.lastFrameGamepadsChecked=this.currentFrame},t.prototype.refreshGamepadList=function(){this._onDevicesChanged.dispatch()},t.prototype.getBoundFunction=function(t){return this.bindCache.hasOwnProperty(t)||(this.bindCache[t]=t.bind(this)),this.bindCache[t]},t.VERSION="1.0.0",t.KeyCodes={ANY:81653812,A:65,ALT:18,B:66,BACKQUOTE:192,BACKSLASH:220,BACKSPACE:8,C:67,CAPS_LOCK:20,COMMA:188,CTRL:17,D:68,DELETE:46,DOWN:40,E:69,END:35,ENTER:13,EQUAL:187,ESCAPE:27,F:70,F1:112,F10:121,F11:122,F12:123,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,G:71,H:72,HOME:36,I:73,INSERT:45,J:74,K:75,L:76,LEFT:37,LEFTBRACKET:219,M:77,MINUS:189,N:78,NUMBER_0:48,NUMBER_1:49,NUMBER_2:50,NUMBER_3:51,NUMBER_4:52,NUMBER_5:53,NUMBER_6:54,NUMBER_7:55,NUMBER_8:56,NUMBER_9:57,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,NUM_LOCK:144,O:79,P:80,PAGE_DOWN:34,PAGE_UP:33,PAUSE:19,PERIOD:190,Q:81,QUOTE:222,R:82,RIGHT:39,RIGHTBRACKET:221,S:83,SCROLL_LOCK:145,SELECT:93,SEMICOLON:186,SHIFT:16,SLASH:191,SPACE:32,T:84,TAB:9,U:85,UP:38,V:86,W:87,WINDOWS_LEFT:91,WINDOWS_RIGHT:92,X:88,Y:89,Z:90},t.KeyLocations={ANY:81653813,STANDARD:0,LEFT:1,RIGHT:2,NUMPAD:3},t.GamepadLocations={ANY:81653814},t.GamepadButtons={ANY:81653815,ACTION_DOWN:0,ACTION_RIGHT:1,ACTION_LEFT:2,ACTION_UP:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_SHOULDER_BOTTOM:6,RIGHT_SHOULDER_BOTTOM:7,SELECT:8,START:9,STICK_LEFT_PRESS:10,STICK_RIGHT_PRESS:11,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15},t.GamepadAxes={STICK_LEFT_X:0,STICK_LEFT_Y:1,STICK_RIGHT_X:2,STICK_RIGHT_Y:3},t}();