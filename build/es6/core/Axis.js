import KeyActionBinder from './KeyActionBinder';
import KeyboardAxisBinding from './KeyboardAxisBinding';
import GamepadAxisBinding from './GamepadAxisBinding';
/**
 * Information linking an axis to a binding, and its value
 */
export default class Axis {
    // ================================================================================================================
    // CONSTRUCTOR ----------------------------------------------------------------------------------------------------
    constructor(id) {
        this._id = id;
        this.keyboardBindings = [];
        this.gamepadAxisBindings = [];
        this.gamepadAxisValue = 0;
    }
    bind(p1, p2, p3, p4, p5) {
        if (typeof p1 === "number") {
            // Keyboard binding
            this.bindKeyboard(p1, p2, p3 == undefined ? KeyActionBinder.KeyLocations.ANY : p3, p4 == undefined ? KeyActionBinder.KeyLocations.ANY : p4, p5 == undefined ? 0.15 : p5);
        }
        else {
            // Gamepad binding
            this.bindGamepad(p1, p2 == undefined ? 0.2 : p2, p3 == undefined ? KeyActionBinder.GamepadLocations.ANY : p3);
        }
        return this;
    }
    interpretKeyDown(keyCode, keyLocation) {
        for (var i = 0; i < this.keyboardBindings.length; i++) {
            if (this.keyboardBindings[i].matchesKeyboardKeyStart(keyCode, keyLocation)) {
                this.keyboardBindings[i].value = -1;
            }
            else if (this.keyboardBindings[i].matchesKeyboardKeyEnd(keyCode, keyLocation)) {
                this.keyboardBindings[i].value = 1;
            }
        }
    }
    interpretKeyUp(keyCode, keyLocation) {
        for (var i = 0; i < this.keyboardBindings.length; i++) {
            if (this.keyboardBindings[i].matchesKeyboardKeyStart(keyCode, keyLocation)) {
                this.keyboardBindings[i].value = 0;
            }
            else if (this.keyboardBindings[i].matchesKeyboardKeyEnd(keyCode, keyLocation)) {
                this.keyboardBindings[i].value = 0;
            }
        }
    }
    interpretGamepadAxis(axisCode, gamepadLocation, valueState) {
        for (var i = 0; i < this.gamepadAxisBindings.length; i++) {
            if (this.gamepadAxisBindings[i].matchesGamepadAxis(axisCode, gamepadLocation)) {
                this.gamepadAxisBindings[i].value = valueState;
            }
        }
    }
    // ================================================================================================================
    // ACCESSOR INTERFACE ---------------------------------------------------------------------------------------------
    get id() {
        return this._id;
    }
    get value() {
        // Gets the highest value
        var bestValue = 0;
        var val;
        // Check keyboard values
        for (var i = 0; i < this.keyboardBindings.length; i++) {
            val = this.keyboardBindings[i].value;
            if (Math.abs(val) > Math.abs(bestValue)) {
                bestValue = val;
            }
        }
        // Check gamepad values
        for (var i = 0; i < this.gamepadAxisBindings.length; i++) {
            val = this.gamepadAxisBindings[i].value;
            if (Math.abs(val) > Math.abs(bestValue)) {
                bestValue = val;
            }
        }
        return bestValue;
    }
    // ================================================================================================================
    // PRIVATE INTERFACE ----------------------------------------------------------------------------------------------
    bindKeyboard(keyCodeA, keyCodeB, keyLocationA, keyLocationB, transitionTimeSeconds) {
        // TODO: check if already present?
        this.keyboardBindings.push(new KeyboardAxisBinding(keyCodeA, keyCodeB, keyLocationA, keyLocationB, transitionTimeSeconds));
    }
    bindGamepad(axis, deadZone, gamepadLocation) {
        // TODO: check if already present?
        this.gamepadAxisBindings.push(new GamepadAxisBinding(axis.index, deadZone, gamepadLocation));
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvcmUvQXhpcy50cyJdLCJuYW1lcyI6WyJBeGlzIiwiQXhpcy5jb25zdHJ1Y3RvciIsIkF4aXMuYmluZCIsIkF4aXMuaW50ZXJwcmV0S2V5RG93biIsIkF4aXMuaW50ZXJwcmV0S2V5VXAiLCJBeGlzLmludGVycHJldEdhbWVwYWRBeGlzIiwiQXhpcy5pZCIsIkF4aXMudmFsdWUiLCJBeGlzLmJpbmRLZXlib2FyZCIsIkF4aXMuYmluZEdhbWVwYWQiXSwibWFwcGluZ3MiOiJPQUFPLGVBQWUsTUFBTSxtQkFBbUI7T0FDeEMsbUJBQW1CLE1BQU0sdUJBQXVCO09BQ2hELGtCQUFrQixNQUFNLHNCQUFzQjtBQUVyRDs7R0FFRztBQUNIO0lBV0NBLG1IQUFtSEE7SUFDbkhBLG1IQUFtSEE7SUFFbkhBLFlBQVlBLEVBQVNBO1FBQ3BCQyxJQUFJQSxDQUFDQSxHQUFHQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUVkQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLEdBQUdBLEVBQUVBLENBQUNBO1FBRTNCQSxJQUFJQSxDQUFDQSxtQkFBbUJBLEdBQUdBLEVBQUVBLENBQUNBO1FBQzlCQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLEdBQUdBLENBQUNBLENBQUNBO0lBQzNCQSxDQUFDQTtJQVlNRCxJQUFJQSxDQUFDQSxFQUFNQSxFQUFFQSxFQUFVQSxFQUFFQSxFQUFVQSxFQUFFQSxFQUFVQSxFQUFFQSxFQUFVQTtRQUNqRUUsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsRUFBRUEsS0FBS0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDNUJBLG1CQUFtQkE7WUFDbkJBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLElBQUlBLFNBQVNBLEdBQUdBLGVBQWVBLENBQUNBLFlBQVlBLENBQUNBLEdBQUdBLEdBQUdBLEVBQUVBLEVBQUVBLEVBQUVBLElBQUlBLFNBQVNBLEdBQUdBLGVBQWVBLENBQUNBLFlBQVlBLENBQUNBLEdBQUdBLEdB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L0F4aXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgS2V5QWN0aW9uQmluZGVyIGZyb20gJy4vS2V5QWN0aW9uQmluZGVyJztcclxuaW1wb3J0IEtleWJvYXJkQXhpc0JpbmRpbmcgZnJvbSAnLi9LZXlib2FyZEF4aXNCaW5kaW5nJztcclxuaW1wb3J0IEdhbWVwYWRBeGlzQmluZGluZyBmcm9tICcuL0dhbWVwYWRBeGlzQmluZGluZyc7XHJcblxyXG4vKipcclxuICogSW5mb3JtYXRpb24gbGlua2luZyBhbiBheGlzIHRvIGEgYmluZGluZywgYW5kIGl0cyB2YWx1ZVxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXhpcyB7XHJcblxyXG5cdC8vIFByb3BlcnRpZXNcclxuXHRwcml2YXRlIF9pZDpzdHJpbmc7XHJcblxyXG5cdHByaXZhdGUga2V5Ym9hcmRCaW5kaW5nczpBcnJheTxLZXlib2FyZEF4aXNCaW5kaW5nPjtcclxuXHJcblx0cHJpdmF0ZSBnYW1lcGFkQXhpc0JpbmRpbmdzOkFycmF5PEdhbWVwYWRBeGlzQmluZGluZz47XHJcblx0cHJpdmF0ZSBnYW1lcGFkQXhpc1ZhbHVlOm51bWJlcjtcclxuXHJcblxyXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHQvLyBDT05TVFJVQ1RPUiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5cdGNvbnN0cnVjdG9yKGlkOnN0cmluZykge1xyXG5cdFx0dGhpcy5faWQgPSBpZDtcclxuXHJcblx0XHR0aGlzLmtleWJvYXJkQmluZGluZ3MgPSBbXTtcclxuXHJcblx0XHR0aGlzLmdhbWVwYWRBeGlzQmluZGluZ3MgPSBbXTtcclxuXHRcdHRoaXMuZ2FtZXBhZEF4aXNWYWx1ZSA9IDA7XHJcblx0fVxyXG5cclxuXHJcblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cdC8vIFBVQkxJQyBJTlRFUkZBQ0UgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcblx0cHVibGljIGJpbmQoa2V5Q29kZUE6bnVtYmVyLCBrZXlDb2RlQjpudW1iZXIpOkF4aXM7XHJcblx0cHVibGljIGJpbmQoa2V5Q29kZUE6bnVtYmVyLCBrZXlDb2RlQjpudW1iZXIsIGtleUxvY2F0aW9uQTpudW1iZXIsIGtleUxvY2F0aW9uQjpudW1iZXIpOkF4aXM7XHJcblx0cHVibGljIGJpbmQoa2V5Q29kZUE6bnVtYmVyLCBrZXlDb2RlQjpudW1iZXIsIGtleUxvY2F0aW9uQTpudW1iZXIsIGtleUxvY2F0aW9uQjpudW1iZXIsIHRyYW5zaXRpb25UaW1lU2Vjb25kczpudW1iZXIpOkF4aXM7XHJcblx0cHVibGljIGJpbmQoYXhpczp7aW5kZXg6bnVtYmVyfSk6QXhpcztcclxuXHRwdWJsaWMgYmluZChheGlzOntpbmRleDpudW1iZXJ9LCBkZWFkWm9uZTpudW1iZXIpOkF4aXM7XHJcblx0cHVibGljIGJpbmQoYXhpczp7aW5kZXg6bnVtYmVyfSwgZGVhZFpvbmU6bnVtYmVyLCBnYW1lcGFkTG9jYXRpb246bnVtYmVyKTpBeGlzO1xyXG5cdHB1YmxpYyBiaW5kKHAxOmFueSwgcDI/Om51bWJlciwgcDM/Om51bWJlciwgcDQ/Om51bWJlciwgcDU/Om51bWJlcik6QXhpcyB7XHJcblx0XHRpZiAodHlwZW9mIHAxID09PSBcIm51bWJlclwiKSB7XHJcblx0XHRcdC8vIEtleWJvYXJkIGJpbmRpbmdcclxuXHRcdFx0dGhpcy5iaW5kS2V5Ym9hcmQocDEsIHAyLCBwMyA9PSB1bmRlZmluZWQgPyBLZXlBY3Rpb25CaW5kZXIuS2V5TG9jYXRpb25zLkFOWSA6IHAzLCBwNCA9PSB1bmRlZmluZWQgPyBLZXlBY3Rpb25CaW5kZXIuS2V5TG9jYXRpb25zLkFOWSA6IHA0LCBwNSA9PSB1bmRlZmluZWQgPyAwLjE1IDogcDUpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Ly8gR2FtZXBhZCBiaW5kaW5nXHJcblx0XHRcdHRoaXMuYmluZEdhbWVwYWQocDEsIHAyID09IHVuZGVmaW5lZCA/IDAuMiA6IHAyLCBwMyA9PSB1bmRlZmluZWQgPyBLZXlBY3Rpb25CaW5kZXIuR2FtZXBhZExvY2F0aW9ucy5BTlkgOiBwMyk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9XHJcblxyXG5cdHB1YmxpYyBpbnRlcnByZXRLZXlEb3duKGtleUNvZGU6bnVtYmVyLCBrZXlMb2NhdGlvbjpudW1iZXIpOnZvaWQge1xyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgdGhpcy5rZXlib2FyZEJpbmRpbmdzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGlmICh0aGlzLmtleWJvYXJkQmluZGluZ3NbaV0ubWF0Y2hlc0tleWJvYXJkS2V5U3RhcnQoa2V5Q29kZSwga2V5TG9jYXRpb24pKSB7XHJcblx0XHRcdFx0dGhpcy5rZXlib2FyZEJpbmRpbmdzW2ldLnZhbHVlID0gLTE7XHJcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5rZXlib2FyZEJpbmRpbmdzW2ldLm1hdGNoZXNLZXlib2FyZEtleUVuZChrZXlDb2RlLCBrZXlMb2NhdGlvbikpIHtcclxuXHRcdFx0XHR0aGlzLmtleWJvYXJkQmluZGluZ3NbaV0udmFsdWUgPSAxO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwdWJsaWMgaW50ZXJwcmV0S2V5VXAoa2V5Q29kZTpudW1iZXIsIGtleUxvY2F0aW9uOm51bWJlcik6dm9pZCB7XHJcblx0XHRmb3IgKHZhciBpOm51bWJlciA9IDA7IGkgPCB0aGlzLmtleWJvYXJkQmluZGluZ3MubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0aWYgKHRoaXMua2V5Ym9hcmRCaW5kaW5nc1tpXS5tYXRjaGVzS2V5Ym9hcmRLZXlTdGFydChrZXlDb2RlLCBrZXlMb2NhdGlvbikpIHtcclxuXHRcdFx0XHR0aGlzLmtleWJvYXJkQmluZGluZ3NbaV0udmFsdWUgPSAwO1xyXG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMua2V5Ym9hcmRCaW5kaW5nc1tpXS5tYXRjaGVzS2V5Ym9hcmRLZXlFbmQoa2V5Q29kZSwga2V5TG9jYXRpb24pKSB7XHJcblx0XHRcdFx0dGhpcy5rZXlib2FyZEJpbmRpbmdzW2ldLnZhbHVlID0gMDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHVibGljIGludGVycHJldEdhbWVwYWRBeGlzKGF4aXNDb2RlOm51bWJlciwgZ2FtZXBhZExvY2F0aW9uOm51bWJlciwgdmFsdWVTdGF0ZTpudW1iZXIpOnZvaWQge1xyXG5cdFx0Zm9yICh2YXIgaTpudW1iZXIgPSAwOyBpIDwgdGhpcy5nYW1lcGFkQXhpc0JpbmRpbmdzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGlmICh0aGlzLmdhbWVwYWRBeGlzQmluZGluZ3NbaV0ubWF0Y2hlc0dhbWVwYWRBeGlzKGF4aXNDb2RlLCBnYW1lcGFkTG9jYXRpb24pKSB7XHJcblx0XHRcdFx0dGhpcy5nYW1lcGFkQXhpc0JpbmRpbmdzW2ldLnZhbHVlID0gdmFsdWVTdGF0ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblxyXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuXHQvLyBBQ0NFU1NPUiBJTlRFUkZBQ0UgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5cdHB1YmxpYyBnZXQgaWQoKTpzdHJpbmcge1xyXG5cdFx0cmV0dXJuIHRoaXMuX2lkO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGdldCB2YWx1ZSgpOm51bWJlciB7XHJcblx0XHQvLyBHZXRzIHRoZSBoaWdoZXN0IHZhbHVlXHJcblx0XHR2YXIgYmVzdFZhbHVlOm51bWJlciA9IDA7XHJcblx0XHR2YXIgdmFsOm51bWJlcjtcclxuXHJcblx0XHQvLyBDaGVjayBrZXlib2FyZCB2YWx1ZXNcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5rZXlib2FyZEJpbmRpbmdzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhbCA9IHRoaXMua2V5Ym9hcmRCaW5kaW5nc1tpXS52YWx1ZTtcclxuXHRcdFx0aWYgKE1hdGguYWJzKHZhbCkgPiBNYXRoLmFicyhiZXN0VmFsdWUpKSB7XHJcblx0XHRcdFx0YmVzdFZhbHVlID0gdmFsO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gQ2hlY2sgZ2FtZXBhZCB2YWx1ZXNcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5nYW1lcGFkQXhpc0JpbmRpbmdzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhbCA9IHRoaXMuZ2FtZXBhZEF4aXNCaW5kaW5nc1tpXS52YWx1ZTtcclxuXHRcdFx0aWYgKE1hdGguYWJzKHZhbCkgPiBNYXRoLmFicyhiZXN0VmFsdWUpKSB7XHJcblx0XHRcdFx0YmVzdFZhbHVlID0gdmFsO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGJlc3RWYWx1ZTtcclxuXHR9XHJcblxyXG5cclxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblx0Ly8gUFJJVkFURSBJTlRFUkZBQ0UgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuXHRwcml2YXRlIGJpbmRLZXlib2FyZChrZXlDb2RlQTpudW1iZXIsIGtleUNvZGVCOm51bWJlciwga2V5TG9jYXRpb25BOm51bWJlciwga2V5TG9jYXRpb25COm51bWJlciwgdHJhbnNpdGlvblRpbWVTZWNvbmRzOm51bWJlcik6dm9pZCB7XHJcblx0XHQvLyBUT0RPOiBjaGVjayBpZiBhbHJlYWR5IHByZXNlbnQ/XHJcblx0XHR0aGlzLmtleWJvYXJkQmluZGluZ3MucHVzaChuZXcgS2V5Ym9hcmRBeGlzQmluZGluZyhrZXlDb2RlQSwga2V5Q29kZUIsIGtleUxvY2F0aW9uQSwga2V5TG9jYXRpb25CLCB0cmFuc2l0aW9uVGltZVNlY29uZHMpKTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgYmluZEdhbWVwYWQoYXhpczp7aW5kZXg6bnVtYmVyfSwgZGVhZFpvbmU6bnVtYmVyLCBnYW1lcGFkTG9jYXRpb246bnVtYmVyKTp2b2lkIHtcclxuXHRcdC8vIFRPRE86IGNoZWNrIGlmIGFscmVhZHkgcHJlc2VudD9cclxuXHRcdHRoaXMuZ2FtZXBhZEF4aXNCaW5kaW5ncy5wdXNoKG5ldyBHYW1lcGFkQXhpc0JpbmRpbmcoYXhpcy5pbmRleCwgZGVhZFpvbmUsIGdhbWVwYWRMb2NhdGlvbikpO1xyXG5cdH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=