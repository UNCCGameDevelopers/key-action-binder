<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title></title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Own styles -->
		<style type="text/css">
			body, document {
				padding: 0;
				margin: 0;
				font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
				font-size: 16px;
				overflow: hidden;
			}
			#videoContainer {
				position: absolute;
				width: 100%;
				height: 100%;
			}
		</style>
		
		<!-- Key-Action-Binder library -->
		<script src="../../build/key-action-binder.js"></script>

		<script>
			/**
			 * Gets a query string parameter, to make it more dynamic
			 **/
			window.getQueryParameter = function(__name) {
				__name = __name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
				var regexS = "[\\?&]" + __name + "=([^&#]*)";
				var regex = new RegExp(regexS);
				var results = regex.exec(window.location.search);
				return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
			};

			/**
			 * Initialize everything
			 **/
			window.init = function(e) {
				console.log("OK");
				
				// Create instance
				binder = new KeyActionBinder();
				binder.action("move-left").addKeyboardBinding(KeyActionBinder.KeyCodes.LEFT);
				binder.action("move-right").addKeyboardBinding(KeyActionBinder.KeyCodes.RIGHT);
				binder.action("fire").addKeyboardBinding(KeyActionBinder.KeyCodes.SPACE);
				
				binder.action("move-left").addGamepadButtonBinding(KeyActionBinder.GamepadButtons.DPAD_LEFT);
				binder.action("move-right").addGamepadButtonBinding(KeyActionBinder.GamepadButtons.DPAD_RIGHT);
				binder.action("fire").addGamepadButtonBinding(KeyActionBinder.GamepadButtons.LEFT_SHOULDER_BOTTOM);
				binder.action("au").addGamepadButtonBinding(KeyActionBinder.GamepadButtons.ACTION_UP);
				binder.action("ad").addGamepadButtonBinding(KeyActionBinder.GamepadButtons.ACTION_DOWN);
				binder.action("al").addGamepadButtonBinding(KeyActionBinder.GamepadButtons.ACTION_LEFT);
				binder.action("ar").addGamepadButtonBinding(KeyActionBinder.GamepadButtons.ACTION_RIGHT);
				
				window.readGamepad = function() {
					requestAnimationFrame(window.readGamepad);
					
					var txt = "";
					txt += "move left = " + binder.action("move-left").activated + ", " + binder.action("move-left").value + "<br>";
					txt += "move right = " + binder.action("move-right").activated + ", " + binder.action("move-right").value + "<br>";
					txt += "fire = " + binder.action("fire").activated + ", " + binder.action("fire").value + "<br>";
					txt += "au = " + binder.action("au").activated + ", " + binder.action("au").value + "<br>"
					txt += "ad = " + binder.action("ad").activated + ", " + binder.action("ad").value + "<br>"
					txt += "al = " + binder.action("al").activated + ", " + binder.action("al").value + "<br>"
					txt += "ar = " + binder.action("ar").activated + ", " + binder.action("ar").value + "<br>"
					
					document.getElementById("messages").innerHTML = txt;
				};
				
				window.readGamepad();
				
				// https://developer.mozilla.org/en-US/docs/Web/Guide/API/Gamepad
				// https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent

				//var gamepadSupportAvailable = navigator.getGamepads
				/*
				window.addEventListener("gamepadconnected", function (e) {
					console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",
					  e.gamepad.index, e.gamepad.id,
					  e.gamepad.buttons.length, e.gamepad.axes.length);
					// Connected: boolean,
					// mapping: string ("standard")
					// axes: number
					// button: .value:number, .pressed:boolean
					// GamepadEvent
				});
				*/

				/*
				window.addEventListener("gamepaddisconnected", function (e) {
					console.log("Gamepad disconnected from index %d: %s",
					  e.gamepad.index, e.gamepad.id);

					// Note:
					// gamepad === navigator.getGamepads()[gamepad.index]
				});
				*/

				/*
				gamepad.BUTTONS = {
				  FACE_1: 0, // Face (main) buttons
				  FACE_2: 1,
				  FACE_3: 2,
				  FACE_4: 3,
				  LEFT_SHOULDER: 4, // Top shoulder buttons
				  RIGHT_SHOULDER: 5,
				  LEFT_SHOULDER_BOTTOM: 6, // Bottom shoulder buttons
				  RIGHT_SHOULDER_BOTTOM: 7,
				  SELECT: 8,
				  START: 9,
				  LEFT_ANALOGUE_STICK: 10, // Analogue sticks (if depressible)
				  RIGHT_ANALOGUE_STICK: 11,
				  PAD_TOP: 12, // Directional (discrete) pad
				  PAD_BOTTOM: 13,
				  PAD_LEFT: 14,
				  PAD_RIGHT: 15
				};

				gamepad.AXES = {
				  LEFT_ANALOGUE_HOR: 0,
				  LEFT_ANALOGUE_VERT: 1,
				  RIGHT_ANALOGUE_HOR: 2,
				  RIGHT_ANALOGUE_VERT: 3
				};
				*/

				// Setup as many action bindings as you want
				//binder.addKeyboardActionBinding("move-left", Keyboard.LEFT);
				//binder.addKeyboardActionBinding("move-right", Keyboard.RIGHT);
				//binder.addGamepadActionBinding("move-left", GamepadControls.DPAD_LEFT);
				//binder.addGamepadActionBinding("move-right", GamepadControls.DPAD_RIGHT);

				/*
				function function gameLoop():void {
					// Evaluate actions
					if (binder.isActionActivated("move-left")) {
						// ...
					} else if (binder.isActionActivated("move-right")) {
						// ...
					}
				}
				*/
			};

			/**
			 * Start
			 **/
			window.addEventListener("load", window.init);

		</script>

	</head>
	<body>
		<div id="messages">OK</div>
	</body>
</html>
